"use strict";var _init=require("./init.js");function _classCallCheck(s,i){if(!(s instanceof i))throw new TypeError("Cannot call a class as a function")}function _defineProperties(s,i){for(var a=0;a<i.length;a++){var t=i[a];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(s,t.key,t)}}function _createClass(s,i,a){return i&&_defineProperties(s.prototype,i),a&&_defineProperties(s,a),s}$(function(){(0,_init.Init)();var i=$(".select_dl:gt(1)");$(".oc-btn").click(function(s){s.preventDefault(),"展开"==$(this).children("span").text()?(i.css("display","block"),$(this).children().text("收起").next().addClass("close")):($(this).children().text("展开").next().removeClass("close"),i.css("display","none"))});var e=1*location.search.slice(9);$.get({url:"http://localhost/commodities/pageCount",data:{classId:e},success:function(s){var i=s.data,a=i.count,t=i.pageCount;new ProductList(e,a,t,$(".list-wrapper")).init()}})});var ProductList=function(){function e(s,i,a,t){_classCallCheck(this,e),this.classId=s,this.count=i,this.pageCount=a,this.page=1,this.mode="default",this.what="",this.root=t,this.data=null}return _createClass(e,[{key:"init",value:function(){var s=this;$(".bar i").text(this.count),this.getList(this.classId,this.page,this.mode,this.what).then(function(){s.renderUI(),s.addEventHandle()})}},{key:"renderUI",value:function(){var s='\n      \x3c!-- 排序 --\x3e\n      <div class="sort-box clearfix">\n        <p class="fl sort">\n          <span>排序方式:</span>\n          <a href="#" class="active default">默认排序</a>\n          <a href="#" class="price">价格</a>\n          <a href="#" class="sell">销量</a>\n        </p>\n        <p class="fr counts">\n          共找到<span>'.concat(this.count,'</span>个商品\n        </p>\n      </div>\n      <ul class="list container clearfix">\n        {{each $data}}\n        <li class="list-item">\n          <div class="wrap">\n            <a href="http://localhost/html/detail.html?id={{$value.id}}">\n              <img width="210" height="210" src="../images/loading.gif" data-src={{$value.bigSrc}} alt="">\n            </a>\n            <div class="scroll">\n              <span class="prev">&lt;</span>\n              <span class="next">&gt;</span>\n              <ul class="clearfix">\n                <li><img src={{$value.smallSrc}} alt=""></li>\n              </ul>\n            </div>\n\n          </div>\n          <a href="#">\n          <div class="desc">\n            <p class="price">\n              <span>￥{{($value.price+0.00).toFixed(2)}}</span>\n              <del>￥{{($value.del+0.00).toFixed(2)}}</del>\n            </p>\n            <p>{{$value.description}}</p>\n            <p>已售出<i>{{$value.sold}}</i>件</p>\n            <p class="size">尺码：{{$value.size}}</p>\n          </div>\n          </a>\n        </li>\n        {{/each}}\n      </ul>\n      <div class="page-btn-box clearfix">\n        <ul class="page-btns">\n\n        </ul>\n      </div>\n    ');if(this.root.html(template.render(s,this.data)),$(".navigation span").text(this.data[0].className),$(".selected h6").text("类别："+this.data[0].className),this.pageBtns=this.root.find(".page-btns"),this.sortBtns=this.root.find(".sort-box"),this.lists=this.root.find(".list"),1==this.pageCount)this.pageBtns.html('<li class="active">1</li>');else{for(var i="<li style='visibility:hidden;'>上一页</li>",a=1;a<=this.pageCount;a++)i+=1==a?'<li class="active">'.concat(a,"</li>"):"<li>".concat(a,"</li>");i+="<li>下一页</li>",this.pageBtns.html(i),lazyLoading()}}},{key:"renderList",value:function(){this.lists.html(template.render('\n    {{each $data}}\n    <li class="list-item">\n      <div class="wrap">\n        <a href="http://localhost/html/detail.html?id={{$value.id}}">\n          <img width="210" height="210" src="../images/loading.gif" data-src={{$value.bigSrc}} alt="">\n        </a>\n        <div class="scroll">\n          <span class="prev">&lt;</span>\n          <span class="next">&gt;</span>\n          <ul class="clearfix">\n            <li><img src={{$value.smallSrc}} alt=""></li>\n          </ul>\n        </div>\n\n      </div>\n      <a href="http://localhost/html/detail.html?id={{$value.id}}">\n      <div class="desc">\n        <p class="price">\n          <span>￥{{$value.price}}</span>\n          <del>￥{{$value.del}}</del>\n        </p>\n        <p>{{$value.description}}</p>\n        <p>已售出<i>{{$value.sold}}</i>件</p>\n        <p class="size">尺码：{{$value.size}}</p>\n      </div>\n      </a>\n    </li>\n    {{/each}}\n    ',this.data)),lazyLoading()}},{key:"getList",value:function(a,t,e,n){var l=this;return new Promise(function(i,s){$.get({url:"http://localhost/commodities/commodity",dataType:"json",data:{classId:a,page:t,mode:e,what:n},success:function(s){1===s.status?(l.data=s.data,i()):alert("数据加载失败")}})})}},{key:"addEventHandle",value:function(){var a=this;this.sortBtns.on("click","a",function(s){var i;s.preventDefault(),a.page=1,i=($(this).hasClass("default")?($(this).addClass("active").siblings("a").removeClass("active"),a.mode="default",a.what=""):($(this).hasClass("price")?a.what="price":a.what="sold",$(this).addClass("active").siblings("a").removeClass("active"),$(this).hasClass("asc")?($(this).removeClass("asc"),a.mode="desc"):($(this).addClass("asc"),a.mode="asc")),a.getList(a.classId,a.page,a.mode,a.what)),a.pageBtns.find("li:eq(0)").css("visibility","hidden"),a.pageBtns.find("li:eq(-1)").css("visibility","visible"),a.pageBtns.find("li:eq(".concat(a.page,")")).addClass("active").siblings().removeClass("active"),i.then(function(){a.renderList()})});var i=this.pageBtns.find("li:eq(0)"),t=this.pageBtns.find("li:eq(-1)");this.pageBtns.on("click","li",function(){var s=$(this).index();0==s?--a.page:s==a.pageCount+1?++a.page:a.page=s,1==a.page?(i.css("visibility","hidden"),t.css("visibility","visible")):a.page==a.pageCount?(t.css("visibility","hidden"),i.css("visibility","visible")):(i.css("visibility","visible"),t.css("visibility","visible")),a.pageBtns.find("li:eq(".concat(a.page,")")).addClass("active").siblings().removeClass("active"),a.getList(a.classId,a.page,a.mode,a.what).then(function(){a.renderList()}),window.scrollTo(0,500)})}}]),e}();