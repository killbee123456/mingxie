"use strict";var _init=require("./init.js");function _classCallCheck(s,n){if(!(s instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(s,n){for(var t=0;t<n.length;t++){var a=n[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(s,a.key,a)}}function _createClass(s,n,t){return n&&_defineProperties(s.prototype,n),t&&_defineProperties(s,t),s}!function(e){e.fn.extend({magnifier:function(){this.each(function(){var a=e(".float",this),i=e(".detail-bigimg img",this),s=e(".detail-bigimg",this);e(".mask",this).mousemove(function(s){var n=s.offsetX,t=s.offsetY;(n-=a.width()/2)<0&&(n=0),(t-=a.height()/2)<0&&(t=0),n>e(this).width()-a.width()&&(n=e(this).width()-a.width()),t>e(this).height()-a.height()&&(t=e(this).height()-a.height()),a.css({top:t,left:n}),i.css({top:-2*t+"px ",left:-2*n+"px"})}).mouseover(function(){a.css({display:"block"}),s.show()}).mouseout(function(){a.css({display:"none"}),s.hide()})})}})}(jQuery),$(function(){(0,_init.Init)(),$.get({url:"http://localhost/commodities/detail",data:{id:location.search.slice(4)},success:function(s){1==s.status?($(".detail-img img,.detail-bigimg img").attr("src",s.data.bigSrc),$(".img-select img").attr("src",s.data.smallSrc),$(".detail-left").magnifier(),new Detail(s.data,$(".detail-right")).init()):(alert(s.msg),location.href="http://localhost/html/list.html?classId="+s.data)}})});var Detail=function(){function t(s,n){_classCallCheck(this,t),this.data=s,this.root=n}return _createClass(t,[{key:"init",value:function(){this.data.size=this.data.size.split("、"),this.renderUI(),this.addEventHandle()}},{key:"renderUI",value:function(){this.root.html(template.render('\n        <div class="name">\n          <span class="more-brand">更多<a href="#">{{$data.brand}}</a></span>\n          <h1 class="goods-name">{{$data.name}}</h1>\n          <div class="sp"></div>\n        </div>\n        <div class="goods-price">\n          <p>\n            <span>吊&nbsp;&nbsp;牌&nbsp;&nbsp;价：</span><del>￥{{$data.del}}</del>\n          </p>\n          <p> <span> 销&nbsp;&nbsp;售&nbsp;&nbsp;价： </span> <span class="price">￥{{$data.price}}</span>\n            &nbsp;&nbsp;(&nbsp;5.0折&nbsp;)&nbsp;&nbsp; <span class="discount price_com">立省： ￥150.00 </span>\n          </p>\n          <p>\n            好&nbsp;&nbsp;评&nbsp;&nbsp;度：&nbsp;&nbsp;<span class="comCountBar"><i class="comment"></i></span>&nbsp;&nbsp;{{$data.score}}分\n            &nbsp;&nbsp;(<a href="#commentTips" class="comCount">已有{{$data.commentCount}}人评论</a>)\n          </p>\n          <p>\n            运&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;费：&nbsp;&nbsp;名鞋库会员满399包邮&nbsp;&nbsp;(&nbsp;不包括货到付款&nbsp;)\n          </p>\n          <p style="color:#ff8383">温馨提示：本款不支持货到付款</p>\n        </div>\n        <div class="push-sale">\n          <div class="wrap clearfix">\n            <div class="t">促销信息</div>\n            <div class="scon"> 满300减30 满600减60&nbsp;&nbsp;限购3件 </div>\n          </div>\n        </div>\n        <div class="select-box">\n          <p class="clearfix size">\n            <span>尺码：</span>\n            {{each $data.size}}\n            <a href="#" class={{$index==0?"selected":""}}>{{$value}}<i class="gou"></i></a>\n            {{/each}}\n          </p>\n          <p class="clearfix">\n            <span>颜色：</span>\n            <a href="#" class="img selected">\n              <img src={{$data.smallSrc}} alt="">\n              <i class="gou"></i>\n            </a>\n          </p>\n          <p class="clearfix btns">\n            <span>购买数量：</span>\n            <a href="#" class="sub">-</a>\n            <input type="text" class="num" value="1">\n            <a href="#" class="add">+</a>\n            <button></button>\n          </p>\n        </div>\n        <div class="sp"></div>\n        <div class="buy-btns">\n          <p>\n            <span class="spec-tip">\n              您将购买<span class="buy-num">1</span>件\n              <span class="buy-cm">42</span>码&nbsp;<span class="color">黑色+白色</span>\n            </span>\n          </p>\n          <div class="btn-box">\n            <a href="#" class="im-buy"></a>\n            <a href="#" class="add-cart"></a>\n          </div>\n        </div>\n        <div class="sp"></div>\n        <div class="promise">\n          <i>名鞋库保障：</i>&nbsp;<img src="//images.s.cn/statics/zheng.png">&nbsp;正品认证&nbsp;&nbsp;&nbsp;&nbsp;<img\n            src="//images.s.cn/statics/tui.png">&nbsp;自由退货&nbsp;&nbsp;&nbsp;&nbsp;<img\n            src="//images.s.cn/statics/mian.png">&nbsp;全场满399免邮\n        </div>\n    ',this.data));var s=Math.round(this.data.score);this.root.find(".comment").css("background-position",12*s-159+"px -178px"),this.size=this.root.find(".size"),this.btns=this.root.find(".btns"),this.cartBtns=this.root.find(".btn-box"),this.buyNumText=this.root.find(".buy-num"),this.buyCm=this.root.find(".buy-cm"),this.buyNumInput=this.root.find(".num");var n=1;Object.defineProperty(this,"buyNum",{set:function(s){this.buyNumInput.val(s),this.buyNumText.text(s),n=s},get:function(){return n}})}},{key:"addEventHandle",value:function(){var n=this;this.size.on("click","a",function(s){s.preventDefault(),$(this).addClass("selected").siblings("a").removeClass("selected"),n.buyCm.text($(this).text())}),this.btns.on("click","a",function(s){s.preventDefault(),"-"==$(this).text()&&1<n.buyNum?n.buyNum--:"+"==$(this).text()&&n.buyNum<20&&n.buyNum++}),this.buyNumInput[0].oninput=function(s){s=s||window.event,/\d/.test(s.data)||null==s.data||(n.buyNum=n.buyNum),1*this.value<1?n.buyNum=1:20<1*this.value?n.buyNum=20:n.buyNum=this.value},this.cartBtns.on("click","a",function(s){s.preventDefault(),$(this).hasClass("im-buy")?alert("暂无此功能，敬请等待，反正我不做!"):$.post({url:"http://localhost/commodities/shopCart",data:{commodityId:n.data.id,count:n.buyNum,selectSize:n.buyCm.text()},success:function(s){1==s.status?($(".cart-num").text(1*$(".cart-num").text()+n.buyNum),alert(s.msg)):(alert(s.msg),$.setItem("originDetail",n.data.id),location.href="http://localhost/html/login.html")}})})}}]),t}();